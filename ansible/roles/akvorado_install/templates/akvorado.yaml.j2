# Akvorado Orchestrator Configuration
# Managed by Ansible - do not edit manually

kafka:
  topic: flows
  brokers:
    - kafka:9092
  topic-configuration:
    num-partitions: 4
    replication-factor: 1
    config-entries:
      segment.bytes: 1073741824
      retention.ms: 86400000
      cleanup.policy: delete
      compression.type: producer

clickhousedb:
  servers:
    - clickhouse:9000

clickhouse:
  orchestrator-url: http://akvorado-orchestrator:8080
  asns:
    64512: Lanmine
  networks:
    10.0.10.0/24:
      name: management
      role: infrastructure

geoip:
  optional: true

inlet:
  flow:
    inputs:
      - type: udp
        decoder: netflow
        listen: :2055
        workers: 2
        receive-buffer: 212992
      - type: udp
        decoder: netflow
        listen: :4739
        workers: 2
        receive-buffer: 212992
      - type: udp
        decoder: sflow
        listen: :6343
        workers: 2
        receive-buffer: 212992

outlet:
  core:
    exporter-classifiers:
{% for exporter in akvorado_exporters %}
      - Exporter.IP == "{{ exporter.ip }}" && ClassifySite("{{ exporter.name }}")
{% endfor %}
    interface-classifiers:
      - ClassifyConnectivity("transit") && ClassifyExternal()
      - ClassifyInternal()
    default-sampling-rate: 1
  metadata:
    providers:
      - type: static
        exporters:
{% for exporter in akvorado_exporters %}
          {{ exporter.ip }}:
            name: {{ exporter.name }}
{% if exporter.interfaces is defined %}
            ifindexes:
{% for ifindex, iface in exporter.interfaces.items() %}
              {{ ifindex }}:
                name: {{ iface.name }}
                description: {{ iface.description }}
                boundary: {{ iface.boundary | default('undefined') }}
{% endfor %}
{% endif %}
{% endfor %}

console:
  http:
    listen: 0.0.0.0:8080
