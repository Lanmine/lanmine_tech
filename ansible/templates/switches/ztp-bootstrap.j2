{# ZTP Bootstrap Configuration Template #}
{# Works for both Cisco IOS and NX-OS #}
{# Variables: hostname, mgmt_ip, enable_secret, ansible_password #}

{% if model.startswith('nexus') %}
{# Nexus NX-OS configuration #}
hostname {{ hostname }}

feature ssh

vlan 99
  name MGMT

interface Ethernet1/48
  description Management
  switchport mode access
  switchport access vlan 99
  no shutdown

interface Vlan99
  description Management Interface
  no shutdown
  ip address {{ mgmt_ip }}/24

ip route 0.0.0.0/0 10.0.99.1

username ansible password {{ ansible_password }} role network-admin
username localadmin password {{ ansible_password }} role network-admin

enable secret {{ enable_secret }}

ssh key rsa 2048

ip domain-name hl0.dev
ip name-server 10.0.99.1

snmp-server user ansible network-admin auth sha {{ snmp_v3_auth_pass }} priv aes-128 {{ snmp_v3_priv_pass }}

logging server 10.0.99.20

ntp server 10.0.99.1

{% else %}
{# Cisco IOS configuration #}
hostname {{ hostname }}

enable secret {{ enable_secret }}

ip domain-name hl0.dev

vlan 99
  name MGMT

interface Vlan99
  description Management Interface
  ip address {{ mgmt_ip }} 255.255.255.0
  no shutdown

ip default-gateway 10.0.99.1
ip name-server 10.0.99.1

username ansible privilege 15 secret {{ ansible_password }}
username localadmin privilege 15 secret {{ ansible_password }}

crypto key generate rsa modulus 2048

ip ssh version 2

line vty 0 15
  login local
  transport input ssh

snmp-server user ansible network-admin v3 auth sha {{ snmp_v3_auth_pass }} priv aes 128 {{ snmp_v3_priv_pass }}

logging host 10.0.99.20

ntp server 10.0.99.1

{% endif %}

banner motd ^
****************************************************
* ZTP Bootstrap Applied - Awaiting Full Config   *
* Managed by Ansible - Do Not Manually Configure *
****************************************************
^

end
