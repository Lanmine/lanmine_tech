---
# Grafana admin credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: grafana-admin
  namespace: monitoring
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault
  target:
    name: grafana-admin
    creationPolicy: Owner
  data:
    - secretKey: admin-user
      remoteRef:
        key: infrastructure/grafana
        property: admin_user
        decodingStrategy: None
      # Default to 'admin' if not set in Vault
    - secretKey: admin-password
      remoteRef:
        key: infrastructure/grafana
        property: admin_password
---
# Grafana OAuth credentials (from Authentik)
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: grafana-oauth
  namespace: monitoring
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault
  target:
    name: grafana-oauth
    creationPolicy: Owner
  data:
    - secretKey: client_id
      remoteRef:
        key: infrastructure/authentik
        property: grafana_client_id
    - secretKey: client_secret
      remoteRef:
        key: infrastructure/authentik
        property: grafana_client_secret
---
# CrowdSec enroll key
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: crowdsec-keys
  namespace: crowdsec
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault
  target:
    name: crowdsec-keys
    creationPolicy: Owner
  data:
    - secretKey: enroll_key
      remoteRef:
        key: infrastructure/crowdsec
        property: enroll_key
---
# CrowdSec Traefik bouncer API key
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: crowdsec-bouncer-key
  namespace: crowdsec
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault
  target:
    name: crowdsec-bouncer-key
    creationPolicy: Owner
  data:
    - secretKey: api_key
      remoteRef:
        key: infrastructure/crowdsec
        property: traefik_bouncer_api_key
---
# Tailscale operator OAuth credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: operator-oauth
  namespace: tailscale
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault
  target:
    name: operator-oauth
    creationPolicy: Owner
  data:
    - secretKey: client_id
      remoteRef:
        key: infrastructure/tailscale
        property: clientId
    - secretKey: client_secret
      remoteRef:
        key: infrastructure/tailscale
        property: clientSecret
---
# GitHub PAT for Flux notifications
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-token
  namespace: flux-system
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault
  target:
    name: github-token
    creationPolicy: Owner
  data:
    - secretKey: token
      remoteRef:
        key: infrastructure/github
        property: pat
