---
# NetBox PostgreSQL credentials from Vault
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: netbox-postgres
  namespace: netbox
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault
    kind: ClusterSecretStore
  target:
    name: netbox-postgres
    creationPolicy: Owner
  data:
    - secretKey: host
      remoteRef:
        key: infrastructure/netbox
        property: db_host
    - secretKey: port
      remoteRef:
        key: infrastructure/netbox
        property: db_port
    - secretKey: database
      remoteRef:
        key: infrastructure/netbox
        property: db_name
    - secretKey: username
      remoteRef:
        key: infrastructure/netbox
        property: db_user
    - secretKey: password
      remoteRef:
        key: infrastructure/netbox
        property: db_password
---
# NetBox Redis credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: netbox-redis
  namespace: netbox
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault
    kind: ClusterSecretStore
  target:
    name: netbox-redis
    creationPolicy: Owner
  data:
    - secretKey: host
      remoteRef:
        key: infrastructure/netbox
        property: redis_host
    - secretKey: port
      remoteRef:
        key: infrastructure/netbox
        property: redis_port
---
# NetBox application secrets
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: netbox-secret
  namespace: netbox
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault
    kind: ClusterSecretStore
  target:
    name: netbox-secret
    creationPolicy: Owner
  data:
    - secretKey: secret-key
      remoteRef:
        key: infrastructure/netbox
        property: secret_key
---
# NetBox superuser credentials
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: netbox-superuser
  namespace: netbox
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault
    kind: ClusterSecretStore
  target:
    name: netbox-superuser
    creationPolicy: Owner
  data:
    - secretKey: username
      remoteRef:
        key: infrastructure/netbox
        property: db_user
    - secretKey: password
      remoteRef:
        key: infrastructure/netbox
        property: superuser_password
    - secretKey: api-token
      remoteRef:
        key: infrastructure/netbox
        property: superuser_api_token
---
# NetBox OAuth credentials for Authentik
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: netbox-oauth
  namespace: netbox
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault
    kind: ClusterSecretStore
  target:
    name: netbox-oauth
    creationPolicy: Owner
  data:
    - secretKey: client-id
      remoteRef:
        key: infrastructure/netbox
        property: oauth_client_id
    - secretKey: client-secret
      remoteRef:
        key: infrastructure/netbox
        property: oauth_client_secret
